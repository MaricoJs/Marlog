"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,a=!1,r=void 0;try{for(var i,l=t[Symbol.iterator]();!(o=(i=l.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){a=!0,r=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function Mlog(opt){if(window.getMlog&&"function"==typeof window.getMlog&&getMlog()instanceof Mlog)return getMlog();var $this=this,$opt=opt,$libs={},$container=void 0,$useStorage=!0,$localforageIsReady=!1,$dbStores=[],$dbIndex=null,$dbLastLogId=0,$dbLastStoreIndex=0,$storeSize=2e3,$Mdata={},$tmpLogsArr=[];$this.init=function(){isUseLocalForage()?replaceConsole().then(initLocalForage).then(localForageInited).then(addTmpLog2Db):replaceConsole().then(initLocalForage).then(localForageInited).catch(addTmpLog2Db),addWrapper(creatWrapper()).then(function(){$container=document.getElementById("mlogMain")})};var creatWrapper=function(){var t=document.createElement("div");return t.innerHTML='\t\t\n\t\t<style type="text/css">\n\t\t\t#mlogWrapper {\n\t\t\t\tposition: fixed;\n\t\t\t\tdisplay: none;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tbackground: rgba(30, 30, 30, .95);\n\t\t\t\tcolor: #f3f3f3;\n\t\t\t\tline-height: 1.5rem;\n\t\t\t\tpadding: 0;\n\t\t\t\tz-index: 9999;\n\t\t\t\tbottom: 0;\n\t\t\t\tmargin: 0 auto;\n\t\t\t\t-webkit-touch-callout: none;\n\t\t\t\t-webkit-user-select: none;\n\t\t\t\t-khtml-user-select: none;\n\t\t\t\t-moz-user-select: none;\n\t\t\t\t-ms-user-select: none;\n\t\t\t\tuser-select: none;\n\t\t\t}\n\t\t\t.mlogWrapper #mlogForm {\n\t\t\t\tposition:fixed;\n\t\t\t\tbottom:0;\n\t\t\t\tdisplay: none;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 3rem;\n\t\t\t\t/*border: 1px solid rgba(250,250,250,.5);*/\n\t\t\t\tbackground: #444;\t\t\t\t\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\tpadding: 0;\n\t\t\t\tmargin: 0;\n\t\t\t\tz-index:99999;/**/\n\t\t\t}\n\t\t\t.mlogWrapper #mlogFormInput {\n\t\t\t\tbackground: none;\n\t\t\t\tborder: 0;\n\t\t\t\toutline: 0;\n\t\t\t\twidth: 90%;\n\t\t\t\theight: 3rem;\n\t\t\t\tline-height: 1.4rem;\n\t\t\t\theight: auto;\n\t\t\t\tpadding: 0;\n\t\t\t\tcolor:#eee;\n\t\t\t}\n\t\t\t.mlogWrapper #mlogFormBt {\n\t\t\t\t/* display: inline-block; */\n\t\t\t\twidth: 8%;\n\t\t\t\ttext-align: center;\n\t\t\t\tline-height: 3rem;\n\t\t\t\tfloat: right;\n\t\t\t\tbackground: rgba(30, 30, 30, .95);\n\t\t\t\tcolor: #fff;\n\t\t\t\tborder-left: 1px solid #fff;\n\t\t\t}\n\t\t\t.mlogWrapper #mlogMain {\n\t\t\t\theight: calc(100% - 6rem);\n\t\t\t\toverflow-y: scroll;\n\t\t\t\toverflow-wrap: break-word;\n\t\t\t\toverflow-x: hidden;\n\t\t\t\tpadding: 1rem;\n\t\t\t}\n\t\t\t.mlogWrapper #mlogHeader {\n\t\t\t\theight: 2rem;\n\t\t\t\tline-height: 2rem;\n\t\t\t\twidth: 100%;\n\t\t\t\ttext-align: right;\n\t\t\t}\n\t\t\t.mlogWrapper #mlogHeader span {\n\t\t\t\tpadding: 0 1rem;\n\t\t\t}\n\n\t\t\t.mlogWrapper .mlog-item {\n\t\t\t\tline-height: 2rem;\n\t\t\t\tmin-height: 18px;\t\t\t\t\n\t\t\t}\n\t\t\t.mlogWrapper .mlog-item-type {\n\t\t\t\tcolor: #679;\n\t\t\t\tpadding-left: 1rem;\n\t\t\t}\n\t\t\t.mlogWrapper .tableMark{\n\t\t\t\tfont-style: normal;\n\t\t\t\tcolor: rgba(250, 250, 250, .05)\n\t\t\t}\n\t\t\t.mlogWrapper .isOpenedMark{\n\t\t\t\tfont-style: normal;\n\t\t\t}\n\t\t\t.isOpenedMark.avalable{\n\t\t\t\tvisibility: hidden;\n\t\t\t}\n\t\t</style>\n\t\t<div class="" id="mlogHeader">\n\t\t\t<span id="mlogMini" onclick="getMlog().setSize(\'min\');"> - </span>\n\t\t\t<span id="mlogHalf"  onclick="getMlog().setSize(\'half\');"> = </span>\n\t\t\t<span id="mlogMax"  onclick="getMlog().setSize(\'max\');"> + </span>\n\t\t\t<span id="mlogClear"  onclick="getMlog().clear();"> c </span>\n\t\t\t<span id="mlogClose"  onclick="getMlog().close();"> x </span>\n\t\t</div>\n\t\t<div class="" id="mlogMain">\n\t\t\t<p class="tc lh05" id="containerTitle"></p>\n\t\t</div>\n\t\t<div class="form" id="mlogForm">\n\t\t\t<textarea rows="2" id="mlogFormInput"> </textarea>\n\t\t\t<span id="mlogFormBt"> &gt; </span>\n\t\t</div>\t\t\t\n\t\t\t',t.id="mlogWrapper",t.className="mlogWrapper",t},addWrapper=function(t){return document.body.appendChild(t),$container=document.getElementById("mlogMain"),new Promise(function(t){t(!0)})},formatMsg=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=getDataType(t),o=_slicedToArray(n,2),a=o[0],r=o[1],i="arrLength";"Array"===a&&(i=t.length);var l={type:e,content:t,dataType:a,time:(new Date).getTime(),iteratable:r};"arrLength"!==i&&(l.arrLength=i);try{throw new Error}catch(t){l.stack=t.stack.replace(/Error\n/).split(/\n/)[1].replace(/^\s+|\s+$/,"")}return l},replaceConsole=function(){return $libs.log=console.log,$libs.error=console.error,$libs.warn=console.warn,$libs.info=console.info,console.log=getNewFun("log"),console.error=getNewFun("error"),console.warn=getNewFun("warn"),console.info=getNewFun("info"),new Promise(function(t){t(!0)})},getNewFun=function(l){return function(){if("function"==typeof $libs[l]){if(0<arguments.length){var t;(t=$libs[l]).call.apply(t,[null].concat(Array.prototype.slice.call(arguments)));var e=!0,n=!1,o=void 0;try{for(var a,r=arguments[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var i=a.value;addLog(formatMsg(i,l))}}catch(t){n=!0,o=t}finally{try{!e&&r.return&&r.return()}finally{if(n)throw o}}}}else alert(l+" is not a function")}},addHtmlItem=function(t){return addChildNodes(document.getElementById("containerTitle"),"getMlog().getLog("+t._id+")","content",!0)},localForageInited=function(n){return new Promise(function(t,e){t(n)})},addTmpLog2Db=function(t){if($tmpLogsArr.length)for(var e=0;e<$tmpLogsArr.length;e++)$tmpLogsArr[e]._id=t+e+1,addToDb($tmpLogsArr[e]);$tmpLogsArr.splice(0,$tmpLogsArr.length)},addLog=function(t){isUseLocalForage()&&!$localforageIsReady?$tmpLogsArr.push(t):addToDb(t)},addToDb=function(t){$dbLastLogId++,t._id=$dbLastLogId,$Mdata["log_"+t._id]=t,addHtmlItem(t),$localforageIsReady&&($dbIndex.setItem("lastLogId",$dbLastLogId),getDbLastStoreIndex($dbLastLogId)-$dbLastStoreIndex==1&&($dbLastStoreIndex=getDbLastStoreIndex($dbLastLogId),creatDbStore($dbLastStoreIndex)),"[object HTMLHeadElement]"==t.content&&(t.content=t.content.outerHTML),$dbStores[$dbLastStoreIndex].setItem("log_"+t._id,t))},getDbLastStoreIndex=function(t){return Math.floor(t/$storeSize)},isUseLocalForage=function(){return!(void 0===window.localforage)&&!0===$useStorage},addChildNodes=function addChildNodes(dom,log,path){var showSelf=3<arguments.length&&void 0!==arguments[3]&&arguments[3],msg=eval(log)[path],_getDataType3=getDataType(msg),_getDataType4=_slicedToArray(_getDataType3,2),dataType=_getDataType4[0],iteratable=_getDataType4[1],makeDOm4Self=function(t,e){var n=document.createElement("div"),o=document.createElement("span"),a=document.createElement("span");o.className="mlog-item-type",o.innerHTML=dataType,a.className="mlog-item-name",a.setAttribute("onclick","getMlog().addChilds(this);"),n.setAttribute("name",t),n.setAttribute("path",e),n.appendChild(a),n.appendChild(o),n.className="mlog-item",a.innerHTML=iteratable?'<i class="isOpenedMark" name="'+t+"_openedMark_"+e+'">▸</i>'+getContent2Shown(msg):'<i class="isOpenedMark avalable"  name="'+t+"_openedMark_"+e+'">▸</i> '+getContent2Shown(msg),dom.parentNode.appendChild(n),dom.parentNode.setAttribute("depth",0)},makeDOm4Child=function(t,e){var n=1*dom.parentNode.getAttribute("depth"),o=document.createElement("div"),a=document.createElement("span"),r=document.createElement("span");a.className="mlog-item-type",a.innerHTML=getDataType(msg[e])[0],r.className="mlog-item-name",r.setAttribute("onclick","getMlog().addChilds(this);"),o.setAttribute("name",t),o.setAttribute("path",e),o.setAttribute("depth",n+1),o.appendChild(r),o.appendChild(a),o.className="mlog-item",getDataType(msg[e])[1]?r.innerHTML='<i class="tableMark">'+"├─".repeat(n+1)+' </i>  <i class="isOpenedMark" name="'+t+"_openedMark_"+e+'">▸</i>  '+e+": "+getContent2Shown(msg[e]):r.innerHTML='<i class="tableMark">'+"├─".repeat(n+1)+' </i>  <i class="isOpenedMark avalable" name="'+t+"_openedMark_"+e+'" >▸</i>  '+e+": "+getContent2Shown(msg[e]),dom.parentNode.appendChild(o)};if(!0===showSelf)makeDOm4Self(log,path);else if(iteratable)for(var key in msg)makeDOm4Child(log+"['"+path+"']",key)},getContent2Shown=function(t){var e=null;switch(getDataType(t)[0]){case"Object":e=" { "+Object.keys(t).join(", ")+" }";break;case"Array":e=" [ length: "+t.length+" ]";break;case"String":e=' "'+t+'"';break;case"Number":e=" "+t}return e},getDataType=function(t){var e=void 0,n=!1;return"[object Object]"==Object.prototype.toString.call(t)?(e="Object",n=!0):"[object Array]"==Object.prototype.toString.call(t)?(e="Array",n=!0):"[object String]"==Object.prototype.toString.call(t)?e="String":"[object Number]"==Object.prototype.toString.call(t)&&(e="Number"),[e,n]},creatDbStore=function(t){$dbStores[t]=localforage.createInstance({name:"store"+t})};$this.addChilds=function(t){var e=t.parentNode.getAttribute("name"),n=t.parentNode.getAttribute("path"),o=document.getElementsByName(e+"['"+n+"']");if(0<o.length){for(var a=o.length-1;0<=a;a--)o[a].parentNode.removeChild(o[a]);return document.getElementsByName(e+"_openedMark_"+n)[0].innerHTML="▸",0}return addChildNodes(t,e,n),document.getElementsByName(e+"_openedMark_"+n)[0].innerHTML="▾",1};var setSize=function(t){var e="";switch(t){case"min":e="5rem";break;case"max":e="100vh";break;case"half":e="50vh";break;case"hide":e="0"}document.getElementById("mlogWrapper").style.height=e},clear=function(){document.getElementById("mlogMain").innerHTML='<p class="tc lh05" id="containerTitle"></p>'},close=function(){document.getElementById("mlogWrapper").style.display="none"},show=function(){document.getElementById("mlogWrapper").style.display="block"};$this.show=function(){return show()},$this.close=function(){return close()},$this.clear=function(){return clear()},$this.setSize=function(t){return setSize(t)},$this.getLog=function(t){return $Mdata["log_"+t]},window.getMlog=function(){return $this};var initLocalForage=function(){return new Promise(function(n,t){isUseLocalForage()?localforage.ready(function(){($dbIndex=localforage.createInstance({name:"index"})).getItem("lastLogId").then(function(t){$dbLastLogId=isNaN(t)?0:t+0;var e=0;for($dbLastStoreIndex=getDbLastStoreIndex($dbLastLogId);creatDbStore(e),++e<=$dbLastStoreIndex;);$localforageIsReady=!(e=null),n($dbLastLogId)})}):t($dbLastLogId=0)})};$this.init()}
//# sourceMappingURL=maps/Mlog.js.map
